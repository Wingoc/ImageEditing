<!DOCTYPE html>
<html>
<head>
	<title>canvas</title>
</head>
<body>
	<canvas id="shuiyinTest" width="900" height="600"></canvas>
	<img id="img_show" src="#" style="display: none;" />
	
	<div>
		<input type="file" id="file" class="filepath" onchange="uploadPicture(this)" >
		<input id="shuiyinText" value="[河苑]喜'阅'新一代亲子共读活动打卡第2天，今天我们阅读了《绿山墙的安妮》P21~P50" type="text"/>
		<button id="shuiyinBtn" class="mui-btn mui-btn-primary" type="button">点击添加文字</button>
		<button id="download" class="mui-btn mui-btn-primary" type="button">下载</button>
	</div>
	



	<script type="text/javascript">

		var img_url = "";

		function shuiyin(canvasid,imgurl,addtext){

			var img = new Image;
			img.src = imgurl;
			img.onload = function(){
				var canvas = document.getElementById(canvasid);
				canvas.style.width = img.width;
				canvas.style.height = img.height;
				console.log(canvas.width);
				console.log(canvas.height);
				console.log(img.width);
				console.log(img.height);
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img,0,0,img.width,img.height,0,0,img.width,img.height);
				ctx.font = "bold 11px 微软雅黑";
				ctx.fillStyle = "rgba(0,0,128,0.8)";
				document.getElementById("shuiyinBtn").onclick = function(){
					var addtext = document.getElementById("shuiyinText").value;
					console.log(addtext.length);
					for (var i = 0; i <= addtext.length / 12; i++){
						if ((12+i*12)<addtext.length){
							ctx.fillText(addtext.slice(i*12, 12+i*12), 160, 12+12*i);
						} else{
							ctx.fillText(addtext.slice(i*12, addtext.Length), 160, 12+12*i);
						}
					}
				}
			}
		}

		function uploadPicture(){

			var reads = new FileReader();
			f = document.getElementById("file").files[0];
			reads.readAsDataURL(f);
			reads.onload = function(e){
				img_url = this.result;
				shuiyin("shuiyinTest",img_url);
			}

		}


		document.getElementById("download").onclick = function(){

			var img_show = document.getElementById("img_show");
			var canvas = document.getElementById("shuiyinTest");
			temp = canvas.toDataURL();
  			img_show.src = temp;
  			canvas.style.display = "none";
  			img_show.style.display = "block";
		}





	</script>
</body>
</html>