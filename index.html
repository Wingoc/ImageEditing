<!DOCTYPE html>
<html>
<head>
	<title>canvas</title>
</head>
<body>
	<canvas id="shuiyinTest"></canvas>
	<input type="file" id="file" class="filepath" onchange="uploadPicture(this)" >
	<div>
		<input id="shuiyinText" value="[河苑]喜'阅'新一代亲子共读活动打卡第2天，今天我们阅读了《绿山墙的安妮》P21~P50" type="text"/>
		<button id="shuiyinBtn" class="mui-btn mui-btn-primary" type="button">点击添加文字</button>
		<button id="download" class="mui-btn mui-btn-primary" type="button">下载</button>
	</div>



	<script type="text/javascript">

		var img_url = "";

		function shuiyin(canvasid,imgurl,addtext){

			var img = new Image;
			img.src = imgurl;
			console.log(img);
			img.onload = function(){
				var canvas = document.getElementById(canvasid);
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img,0,0,canvas.width,canvas.height);
				ctx.font = "bold 11px 微软雅黑";
				ctx.fillStyle = "rgba(0,0,128,0.8)";
				document.getElementById("shuiyinBtn").onclick = function(){
					var addtext = document.getElementById("shuiyinText").value;
					console.log(addtext.length);
					for (var i = 0; i <= addtext.length / 12; i++){
						if ((12+i*12)<addtext.length){
							ctx.fillText(addtext.slice(i*12, 12+i*12), 160, 12+12*i);
						} else{
							ctx.fillText(addtext.slice(i*12, addtext.Length), 160, 12+12*i);
						}
					}
				}
			}
		}

		function uploadPicture(){

			var reads = new FileReader();
			f = document.getElementById("file").files[0];
			reads.readAsDataURL(f);
			reads.onload = function(e){
				img_url = this.result;
				shuiyin("shuiyinTest",img_url);
			}

		}


		document.getElementById("download").onclick = function(){

			var a = document.createElement("a");
			canvas = document.getElementById("shuiyinTest");
  			a.href = canvas.toDataURL();
  			a.download = 'abc';
  			a.click();
		}





	</script>
</body>
</html>